# å®ä½“å­˜å‚¨å™¨ä¿®å¤æ–¹æ¡ˆ

## é—®é¢˜æè¿°
åœ¨ä½¿ç”¨152639.jsonæ—¶åˆ›å»ºçš„å¢™ä½“å‡ä¸ºé»˜è®¤å¢™ä½“ï¼Œåœ¨é€‰æ‹©å®ä½“æ—¶æ— è®ºç‚¹å‡»å¢™ä½“èœå•ä¸­çš„å“ªä¸ª"é»˜è®¤å®ä½“"éƒ½åªä¼šé€‰ä¸­ç›¸åŒçš„å¢™ã€‚è¿™æ˜¯å› ä¸ºåŒç±»å…ƒç´ å‘½åç›¸åŒæ—¶ï¼Œå®ä½“å­˜å‚¨å™¨æ— æ³•æ­£ç¡®åŒºåˆ†å®ƒä»¬ï¼Œå¯¼è‡´é€‰æ‹©åŠŸèƒ½å‡ºç°é—®é¢˜ã€‚

**æ–°å¢éœ€æ±‚**ï¼š
1. é—¨æ˜¯æŒ–å‡ºæ¥çš„ï¼Œä¸éœ€è¦å®šä½ï¼Œèœå•æ æŠŠé—¨å»é™¤
2. å¯¹åŒç±»å®ä½“å¢åŠ æ‰¹é‡é€‰æ‹©åŠŸèƒ½ï¼Œå¯ä»¥ä¸€æ¬¡æ€§é€‰æ‹©æ‰€æœ‰åŒç±»å‹å®ä½“
3. é€‰æ‹©å¢™ä½“æ—¶ä¸æ‰©é€‰åˆ°çª—æˆ·ï¼Œé¿å…å®ä½“é€‰æ‹©å†²çª

## æ ¹æœ¬åŸå› åˆ†æ

### 1. å®ä½“å‘½åé‡å¤
- å¤šä¸ªå¢™ä½“ä½¿ç”¨ç›¸åŒçš„åç§°ï¼ˆå¦‚"é»˜è®¤å¢™ä½“"ï¼‰
- å®ä½“å­˜å‚¨å™¨æ— æ³•åŒºåˆ†åŒåå®ä½“
- èœå•é¡¹æŒ‡å‘é”™è¯¯çš„å®ä½“

### 2. ç¼ºå°‘å”¯ä¸€æ ‡è¯†ç¬¦
- å®ä½“æ²¡æœ‰å”¯ä¸€çš„IDå±æ€§
- æ— æ³•é€šè¿‡IDç²¾ç¡®å®šä½å®ä½“
- é€‰æ‹©åŠŸèƒ½ä¾èµ–åç§°è€Œéå”¯ä¸€æ ‡è¯†

### 3. èœå•åˆ›å»ºé€»è¾‘é—®é¢˜
- åŒåå®ä½“åœ¨èœå•ä¸­æ˜¾ç¤ºç›¸åŒåç§°
- æ— æ³•åŒºåˆ†ä¸åŒçš„å®ä½“å®ä¾‹
- é€‰æ‹©æ—¶æ€»æ˜¯é€‰ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…çš„å®ä½“

### 4. åŠŸèƒ½éœ€æ±‚é—®é¢˜
- é—¨æ˜¯æŒ–å‡ºæ¥çš„ï¼Œä¸éœ€è¦å®šä½åŠŸèƒ½
- ç¼ºå°‘åŒç±»å®ä½“çš„æ‰¹é‡é€‰æ‹©åŠŸèƒ½
- æ— æ³•ä¸€æ¬¡æ€§æ“ä½œæ‰€æœ‰åŒç±»å‹å®ä½“

### 5. å®ä½“é€‰æ‹©å†²çªé—®é¢˜
- é€‰æ‹©å¢™ä½“æ—¶è‡ªåŠ¨é€‰ä¸­çª—æˆ·ï¼ˆçª—æˆ·åµŒå…¥åœ¨å¢™ä½“ä¸­ï¼‰
- é€‰æ‹©çª—æˆ·æ—¶è‡ªåŠ¨é€‰ä¸­å¢™ä½“
- å®ä½“é€‰æ‹©ä¸å¤Ÿç²¾ç¡®ï¼Œå½±å“æ“ä½œæ•ˆç‡

## ä¿®å¤æ–¹æ¡ˆ

### 1. å®ä½“å”¯ä¸€æ ‡è¯†ç³»ç»Ÿ

#### 1.1 å”¯ä¸€IDç”Ÿæˆ
```ruby
# ä¸ºæ¯ä¸ªå®ä½“ç”Ÿæˆå”¯ä¸€ID
wall_id = wall_data["id"] || "wall_#{wall_entities.length + 1}"
equipment_id = equipment_data["id"] || "equipment_#{equipment_count + 1}"
zone_id = zone["id"] || "zone_#{zone_index + 1}"
```

#### 1.2 å”¯ä¸€åç§°ç”Ÿæˆ
```ruby
# ç”ŸæˆåŒ…å«å”¯ä¸€æ ‡è¯†çš„åç§°
def get_entity_name(entity)
  base_name = get_base_name(entity)
  unique_id = get_unique_identifier(entity)
  "#{base_name}_#{unique_id}"
end
```

### 2. å®ä½“å±æ€§è®¾ç½®

#### 2.1 å¢™ä½“å±æ€§
```ruby
wall_group.set_attribute('FactoryImporter', 'id', wall_id)
wall_group.set_attribute('FactoryImporter', 'wall_id', wall_id)
wall_group.set_attribute('FactoryImporter', 'name', wall_name)
```

#### 2.2 è®¾å¤‡å±æ€§
```ruby
equipment_group.set_attribute('FactoryImporter', 'id', equipment_id)
equipment_group.set_attribute('FactoryImporter', 'equipment_id', equipment_id)
equipment_group.set_attribute('FactoryImporter', 'name', equipment_name)
```

#### 2.3 åŒºåŸŸå±æ€§
```ruby
zone_group.set_attribute('FactoryImporter', 'id', zone["id"])
zone_group.set_attribute('FactoryImporter', 'zone_id', zone["id"])
zone_group.set_attribute('FactoryImporter', 'zone_name', zone["name"])
```

### 3. å®ä½“å­˜å‚¨å™¨ä¼˜åŒ–

#### 3.1 å”¯ä¸€æ ‡è¯†ç¬¦è·å–
```ruby
def get_unique_identifier(entity)
  # ä¼˜å…ˆä½¿ç”¨è‡ªå®šä¹‰ID
  if entity.respond_to?(:get_attribute)
    custom_id = entity.get_attribute('FactoryImporter', 'id') ||
                entity.get_attribute('FactoryImporter', 'wall_id') ||
                entity.get_attribute('FactoryImporter', 'equipment_id') ||
                entity.get_attribute('FactoryImporter', 'zone_id') ||
                entity.get_attribute('FactoryImporter', 'flow_id')
    
    return custom_id if custom_id
  end
  
  # ä½¿ç”¨å®ä½“IDä½œä¸ºå¤‡é€‰
  entity.entityID.to_s
end
```

#### 3.2 èœå•åˆ›å»ºä¼˜åŒ–
```ruby
# ä¸ºæ¯ä¸ªå®ä½“åˆ›å»ºå”¯ä¸€çš„èœå•é¡¹
entities.each do |entity_record|
  entity_name = entity_record[:name]  # ç°åœ¨åŒ…å«å”¯ä¸€æ ‡è¯†
  type_menu.add_item(entity_name) {
    select_entity_in_sketchup(entity_record)
  }
end
```

### 4. å®ä½“é€‰æ‹©å™¨å¢å¼º

#### 4.1 è¯¦ç»†é€‰æ‹©å™¨
```ruby
def show_detailed_entity_selector(entity_type, entities)
  options = entities.map.with_index do |entity_record, index|
    "#{index + 1}. #{entity_record[:name]}"
  end
  
  prompt = "è¯·è¾“å…¥è¦é€‰æ‹©çš„ #{get_type_display_name(entity_type)} ç¼–å· (1-#{entities.size}):"
  input = UI.inputbox([prompt], ["1"], "é€‰æ‹©å®ä½“")
  
  if input
    index = input[0].to_i - 1
    if index >= 0 && index < entities.size
      select_entity_in_sketchup(entities[index])
    end
  end
end
```

### 5. æ‰¹é‡é€‰æ‹©åŠŸèƒ½

#### 5.1 æ‰¹é‡é€‰æ‹©æ‰€æœ‰åŒç±»å‹å®ä½“
```ruby
def select_all_entities_by_type(entity_type)
  model = Sketchup.active_model
  selection = model.selection
  entities = get_entities_by_type(entity_type)
  
  # æ¸…é™¤å½“å‰é€‰æ‹©å¹¶é€‰æ‹©æ‰€æœ‰æœ‰æ•ˆå®ä½“
  selection.clear
  entities.each do |entity_record|
    entity = entity_record[:entity]
    if entity && entity.valid?
      selection.add(entity)
    end
  end
  
  # è°ƒæ•´è§†å›¾æ˜¾ç¤ºæ‰€æœ‰é€‰ä¸­å®ä½“
  model.active_view.zoom(selection)
end
```

#### 5.2 æ·»åŠ åˆ°å½“å‰é€‰æ‹©
```ruby
def add_all_entities_by_type_to_selection(entity_type)
  model = Sketchup.active_model
  selection = model.selection
  entities = get_entities_by_type(entity_type)
  
  # æ·»åŠ åˆ°å½“å‰é€‰æ‹©
  entities.each do |entity_record|
    entity = entity_record[:entity]
    if entity && entity.valid?
      selection.add(entity)
    end
  end
  
  # è¿‡æ»¤æ‰å†²çªçš„å®ä½“
  filter_conflicting_entities_from_selection(model, selection, entity_type)
end
```

### 6. å®ä½“å†²çªè¿‡æ»¤åŠŸèƒ½ï¼ˆå¢™ä½“å’Œçª—æˆ·å¯¹åº”å…³ç³»æ–¹æ¡ˆï¼‰

#### 6.1 å¯¹åº”å…³ç³»å­˜å‚¨
```ruby
@@wall_window_mapping = {}  # å­˜å‚¨å¢™ä½“å’Œçª—æˆ·çš„å¯¹åº”å…³ç³»

def add_wall_window_mapping(wall_id, window_entity_record)
  # å»ºç«‹å¢™ä½“å’Œçª—æˆ·çš„å¯¹åº”å…³ç³»
end

def get_windows_for_wall(wall_id)
  # è·å–æŒ‡å®šå¢™ä½“å¯¹åº”çš„æ‰€æœ‰çª—æˆ·
end
```

#### 6.2 åé€‰è¿‡æ»¤åŸç†
```ruby
def remove_windows_using_mapping(model, selection, wall_entity_record)
  # 1. è·å–å¢™ä½“ID
  # 2. æŸ¥æ‰¾è¯¥å¢™ä½“å¯¹åº”çš„æ‰€æœ‰çª—æˆ·
  # 3. ä»é€‰æ‹©ä¸­ç§»é™¤å¯¹åº”çš„çª—æˆ·å®ä½“
  # 4. æœ€ç»ˆåªä¿ç•™å¢™ä½“
end
```

#### 6.3 åº”ç”¨åœºæ™¯
- **é€‰æ‹©å¢™ä½“**ï¼šæ ¹æ®å¢™ä½“IDæŸ¥æ‰¾å¯¹åº”çª—æˆ· â†’ ç§»é™¤çª—æˆ· â†’ åªä¿ç•™å¢™ä½“
- **æ‰¹é‡é€‰æ‹©å¢™ä½“**ï¼šå¤„ç†æ‰€æœ‰å¢™ä½“çš„å¯¹åº”çª—æˆ·
- **æ·»åŠ å¢™ä½“åˆ°é€‰æ‹©**ï¼šå¤„ç†æ‰€æœ‰å¢™ä½“çš„å¯¹åº”çª—æˆ·
- **ç²¾ç¡®åé€‰**ï¼šç›´æ¥ä½¿ç”¨å­˜å‚¨å™¨ä¸­çš„å®ä½“ï¼Œé¿å…å±æ€§è¯†åˆ«é—®é¢˜

### 7. æè´¨åº”ç”¨ä¿æŠ¤åŠŸèƒ½ï¼ˆé˜²æ­¢è¦†ç›–çª—æˆ·ï¼‰

#### 7.1 çª—æˆ·è¯†åˆ«æœºåˆ¶
```ruby
def window_like_entity?(entity)
  # é€šè¿‡å¤šç§å±æ€§åˆ¤æ–­æ˜¯å¦ä¸ºçª—æˆ·ç›¸å…³å®ä½“
  # - window_type: wall_window/independent_window
  # - window_name: åŒ…å«"window"æˆ–"çª—"
  # - type: "window"
  # - å®ä½“åç§°: åŒ…å«"window"æˆ–"çª—"
end

def face_is_window_glass?(face)
  # åˆ¤æ–­é¢æ˜¯å¦ä¸ºçª—æˆ·ç»ç’ƒ
  # - face_type: "window_glass"
end
```

#### 7.2 æè´¨åº”ç”¨ä¿æŠ¤
```ruby
def apply_material_to_group_entities(group, material_definition)
  # é€’å½’åº”ç”¨æè´¨æ—¶è‡ªåŠ¨è·³è¿‡ï¼š
  # 1. çª—æˆ·å­ç»„ (window_like_entity?)
  # 2. çª—æˆ·ç»ç’ƒé¢ (face_is_window_glass?)
  # 3. éšè—å®ä½“
end
```

#### 7.3 ä¿æŠ¤æ•ˆæœ
- âœ… **å¢™ä½“æè´¨æ­£å¸¸åº”ç”¨**ï¼šå¢™ä½“æˆåŠŸè·å¾—æ–°æè´¨
- âœ… **çª—æˆ·æè´¨ä¿æŒ**ï¼šçª—æˆ·ç»ç’ƒä¿æŒåŸæœ‰æè´¨å’Œæ•ˆæœ
- âœ… **è‡ªåŠ¨è¯†åˆ«è·³è¿‡**ï¼šæ— éœ€æ‰‹åŠ¨é€‰æ‹©ï¼Œç³»ç»Ÿè‡ªåŠ¨ä¿æŠ¤çª—æˆ·
- âœ… **é€’å½’ä¿æŠ¤**ï¼šæ·±åº¦åµŒå¥—çš„çª—æˆ·å®ä½“ä¹Ÿèƒ½è¢«æ­£ç¡®è¯†åˆ«å’Œä¿æŠ¤

## ä¿®å¤æ•ˆæœ

### 1. å®ä½“å”¯ä¸€æ€§
- âœ… æ¯ä¸ªå®ä½“éƒ½æœ‰å”¯ä¸€çš„ID
- âœ… æ¯ä¸ªå®ä½“éƒ½æœ‰å”¯ä¸€çš„åç§°
- âœ… å®ä½“å¯ä»¥é€šè¿‡IDç²¾ç¡®å®šä½

### 2. é€‰æ‹©åŠŸèƒ½
- âœ… åŒåå®ä½“å¯ä»¥æ­£ç¡®åŒºåˆ†
- âœ… èœå•é¡¹æŒ‡å‘æ­£ç¡®çš„å®ä½“
- âœ… é€‰æ‹©åŠŸèƒ½å‡†ç¡®æ— è¯¯
- âœ… æ”¯æŒæ‰¹é‡é€‰æ‹©æ‰€æœ‰åŒç±»å‹å®ä½“
- âœ… æ”¯æŒæ·»åŠ åˆ°å½“å‰é€‰æ‹©
- âœ… æ™ºèƒ½è¿‡æ»¤å†²çªå®ä½“
- âœ… é¿å…é€‰æ‹©å¢™ä½“æ—¶é€‰ä¸­çª—æˆ·

### 3. ç”¨æˆ·ä½“éªŒ
- âœ… å®ä½“åç§°æ¸…æ™°å¯è¯»
- âœ… é€‰æ‹©æ“ä½œç›´è§‚ç®€å•
- âœ… æ”¯æŒå¤§é‡å®ä½“çš„ç®¡ç†
- âœ… æ‰¹é‡æ“ä½œæé«˜æ•ˆç‡
- âœ… èœå•ç»“æ„æ›´åŠ åˆç†
- âœ… é€‰æ‹©ç²¾ç¡®ï¼Œé¿å…è¯¯é€‰
- âœ… æ“ä½œæ›´åŠ é«˜æ•ˆ
- âœ… æè´¨åº”ç”¨æ™ºèƒ½ä¿æŠ¤çª—æˆ·
- âœ… æ— éœ€æ‰‹åŠ¨æ’é™¤ï¼Œç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«

## ä½¿ç”¨æ–¹æ³•

### 1. æ­£å¸¸ä½¿ç”¨
1. å¯¼å…¥å·¥å‚å¸ƒå±€æ–‡ä»¶
2. ä½¿ç”¨ `Extensions` â†’ `å®ä½“å­˜å‚¨å™¨` â†’ `å¢™ä½“` â†’ é€‰æ‹©å…·ä½“å¢™ä½“
3. æ¯ä¸ªå¢™ä½“éƒ½æœ‰å”¯ä¸€çš„åç§°å’ŒID

### 2. æ‰¹é‡é€‰æ‹©ä½¿ç”¨
1. **é€‰æ‹©æ‰€æœ‰åŒç±»å‹å®ä½“**ï¼š
   - `Extensions` â†’ `å®ä½“å­˜å‚¨å™¨` â†’ `å¢™ä½“` â†’ `é€‰æ‹©æ‰€æœ‰å¢™ä½“`
   - ä¸€æ¬¡æ€§é€‰ä¸­æ‰€æœ‰å¢™ä½“å®ä½“

2. **æ·»åŠ åˆ°å½“å‰é€‰æ‹©**ï¼š
   - `Extensions` â†’ `å®ä½“å­˜å‚¨å™¨` â†’ `å¢™ä½“` â†’ `æ·»åŠ æ‰€æœ‰å¢™ä½“åˆ°é€‰æ‹©`
   - å°†å¢™ä½“æ·»åŠ åˆ°å½“å‰é€‰æ‹©ä¸­ï¼Œä¸æ¸…é™¤å…¶ä»–é€‰æ‹©

3. **æ··åˆé€‰æ‹©**ï¼š
   - å…ˆé€‰æ‹©ä¸€äº›å¢™ä½“
   - å†æ·»åŠ æ‰€æœ‰çª—æˆ·åˆ°é€‰æ‹©
   - å®ç°è·¨ç±»å‹çš„æ‰¹é‡æ“ä½œ

### 3. æµ‹è¯•éªŒè¯
1. ä½¿ç”¨ `Extensions` â†’ `å®ä½“å­˜å‚¨å™¨æµ‹è¯•` â†’ `æµ‹è¯•å®ä½“å”¯ä¸€æ€§`
2. ä½¿ç”¨ `Extensions` â†’ `å®ä½“å­˜å‚¨å™¨æµ‹è¯•` â†’ `æµ‹è¯•å®ä½“é€‰æ‹©`
3. ä½¿ç”¨ `Extensions` â†’ `å®ä½“å­˜å‚¨å™¨æµ‹è¯•` â†’ `æµ‹è¯•æ‰¹é‡é€‰æ‹©`
4. éªŒè¯æ¯ä¸ªå®ä½“éƒ½å¯ä»¥æ­£ç¡®é€‰æ‹©

### 4. è°ƒè¯•åŠŸèƒ½
1. ä½¿ç”¨ `Extensions` â†’ `å®ä½“å­˜å‚¨å™¨æµ‹è¯•` â†’ `æµ‹è¯•å®ä½“å±æ€§`
2. æŸ¥çœ‹å®ä½“çš„è¯¦ç»†å±æ€§ä¿¡æ¯
3. ç¡®è®¤å”¯ä¸€æ ‡è¯†ç¬¦æ­£ç¡®è®¾ç½®

### 5. è¿‡æ»¤åŠŸèƒ½æµ‹è¯•
1. ä½¿ç”¨ `Extensions` â†’ `å®ä½“å­˜å‚¨å™¨æµ‹è¯•` â†’ `æµ‹è¯•å®ä½“è¿‡æ»¤`
2. æµ‹è¯•é€‰æ‹©å¢™ä½“æ—¶çš„çª—æˆ·è¿‡æ»¤
3. æµ‹è¯•é€‰æ‹©çª—æˆ·æ—¶çš„å¢™ä½“è¿‡æ»¤
4. æµ‹è¯•æ··åˆé€‰æ‹©åŠŸèƒ½

### 6. æè´¨ä¿æŠ¤åŠŸèƒ½æµ‹è¯•
1. æ‰¹é‡é€‰æ‹©å¢™ä½“ï¼š`Extensions` â†’ `å®ä½“å­˜å‚¨å™¨` â†’ `å¢™ä½“` â†’ `é€‰æ‹©æ‰€æœ‰å¢™ä½“`
2. åº”ç”¨æè´¨ï¼š`Extensions` â†’ `æè´¨ç®¡ç†å™¨` â†’ é€‰æ‹©ä»»æ„æè´¨
3. **éªŒè¯æ•ˆæœ**ï¼š
   - å¢™ä½“æˆåŠŸåº”ç”¨æ–°æè´¨
   - çª—æˆ·ä¿æŒåŸæœ‰æè´¨å’Œç»ç’ƒæ•ˆæœ
   - æ§åˆ¶å°æ˜¾ç¤º"è·³è¿‡çª—æˆ·å­ç»„"å’Œ"è·³è¿‡çª—æˆ·ç»ç’ƒé¢"æ—¥å¿—

### 7. ç«‹æŸ±å­˜å‚¨åŠŸèƒ½æµ‹è¯•
1. ç«‹æŸ±å­˜å‚¨éªŒè¯ï¼š`Extensions` â†’ `å®ä½“è¿‡æ»¤è°ƒè¯•` â†’ `æµ‹è¯•ç«‹æŸ±å­˜å‚¨`
2. **éªŒè¯æ•ˆæœ**ï¼š
   - ç«‹æŸ±å®ä½“æ­£ç¡®å­˜å‚¨åˆ°å­˜å‚¨å™¨
   - ç«‹æŸ±å±æ€§å®Œæ•´ï¼ˆtype, column_id, column_nameç­‰ï¼‰
   - ç«‹æŸ±å…ƒæ•°æ®åŒ…å«é«˜åº¦ã€åæ ‡ç‚¹ç­‰ä¿¡æ¯
   - ç«‹æŸ±æ”¯æŒæ‰¹é‡é€‰æ‹©å’Œä¸ªä½“é€‰æ‹©

## æŠ€æœ¯ç»†èŠ‚

### 1. å‘½åè§„åˆ™
- **å¢™ä½“**: `å¢™ä½“_${wall_id}` æˆ– `å¢™ä½“_${wall_1}`
- **ç«‹æŸ±**: `ç«‹æŸ±_${column_id}` æˆ– `ç«‹æŸ±_${column_index}`
- **è®¾å¤‡**: `${equipment_name} (${equipment_id})`
- **åŒºåŸŸ**: `${zone_name}_${zone_id}` æˆ– `åŒºåŸŸ_${zone_id}`
- **æµé€šé“**: `æµé€šé“_${flow_id}` æˆ– `æµé€šé“_${flow_index}`
- **çª—æˆ·**: `çª—æˆ·_${window_id}` æˆ– `çª—æˆ·_${window_index}`
- **å·¥å‚åœ°é¢**: `å·¥å‚å¤§åœ°é¢_${ground_id}`

### 2. çª—æˆ·ä¿æŠ¤æœºåˆ¶
- **çª—æˆ·è¯†åˆ«**: é€šè¿‡ `window_type`ã€`window_name`ã€`type`ã€å®ä½“åç§°ç­‰å¤šé‡å±æ€§åˆ¤æ–­
- **ç»ç’ƒé¢è¯†åˆ«**: é€šè¿‡ `face_type = "window_glass"` è¯†åˆ«çª—æˆ·ç»ç’ƒé¢
- **é€’å½’ä¿æŠ¤**: åœ¨æè´¨é€’å½’åº”ç”¨è¿‡ç¨‹ä¸­è‡ªåŠ¨è·³è¿‡çª—æˆ·ç›¸å…³å®ä½“
- **å±æ€§æ£€æŸ¥**: æ”¯æŒä¸­è‹±æ–‡åç§°è¯†åˆ«ï¼ˆ"window"ã€"çª—æˆ·"ç­‰ï¼‰

### 2. IDç”Ÿæˆç­–ç•¥
- **ä¼˜å…ˆä½¿ç”¨**: JSONæ•°æ®ä¸­çš„åŸå§‹ID
- **å¤‡é€‰æ–¹æ¡ˆ**: ç±»å‹å‰ç¼€ + åºå·
- **å…œåº•æ–¹æ¡ˆ**: SketchUpå®ä½“ID
- **æ”¯æŒç±»å‹**: wall_id, equipment_id, zone_id, flow_id, column_id

### 3. å±æ€§å­˜å‚¨
- **æ ‡å‡†å±æ€§**: `id`, `name`
- **ç±»å‹å±æ€§**: `wall_id`, `equipment_id`, `zone_id`, `flow_id`, `window_id`, `column_id`
- **å…ƒæ•°æ®**: ä½ç½®ã€å°ºå¯¸ã€ç±»å‹ç­‰è¯¦ç»†ä¿¡æ¯

### 4. èœå•ç»“æ„
- **ç§»é™¤é—¨ç±»å‹**: é—¨æ˜¯æŒ–å‡ºæ¥çš„ï¼Œä¸éœ€è¦å®šä½åŠŸèƒ½
- **æ–°å¢ç«‹æŸ±ç±»å‹**: æ”¯æŒç«‹æŸ±çš„å­˜å‚¨ã€é€‰æ‹©å’Œæ‰¹é‡æ“ä½œ
- **æ‰¹é‡é€‰æ‹©**: æ¯ä¸ªç±»å‹éƒ½æœ‰"é€‰æ‹©æ‰€æœ‰"å’Œ"æ·»åŠ åˆ°é€‰æ‹©"åŠŸèƒ½
- **ä¸ªä½“é€‰æ‹©**: ä¿ç•™å•ä¸ªå®ä½“çš„é€‰æ‹©åŠŸèƒ½
- **ç»Ÿè®¡ä¿¡æ¯**: æä¾›æ¯ç§ç±»å‹çš„ç»Ÿè®¡ä¿¡æ¯

### 5. å†²çªè¿‡æ»¤è§„åˆ™
- **å¢™ä½“ vs çª—æˆ·**: é€‰æ‹©å¢™ä½“æ—¶è¿‡æ»¤çª—æˆ·ï¼Œé€‰æ‹©çª—æˆ·æ—¶è¿‡æ»¤å¢™ä½“
- **é—¨ vs å¢™ä½“**: é€‰æ‹©é—¨æ—¶è¿‡æ»¤å¢™ä½“
- **è®¾å¤‡ vs åŒºåŸŸ**: é€‰æ‹©è®¾å¤‡æ—¶è¿‡æ»¤åŒºåŸŸï¼Œé€‰æ‹©åŒºåŸŸæ—¶è¿‡æ»¤è®¾å¤‡
- **å¯æ‰©å±•**: æ”¯æŒæ·»åŠ æ–°çš„å†²çªè§„åˆ™

## å…¼å®¹æ€§è¯´æ˜

### 1. å‘åå…¼å®¹
- ç°æœ‰å®ä½“ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œ
- æ—§ç‰ˆæœ¬çš„å®ä½“ä¼šè¢«è‡ªåŠ¨åˆ†é…å”¯ä¸€ID
- ä¸ä¼šå½±å“ç°æœ‰çš„å·¥ä½œæµç¨‹

### 2. å‘å‰å…¼å®¹
- æ–°åˆ›å»ºçš„å®ä½“è‡ªåŠ¨ä½¿ç”¨å”¯ä¸€æ ‡è¯†
- æ”¯æŒæœªæ¥æ‰©å±•çš„å®ä½“ç±»å‹
- ä¿æŒAPIæ¥å£çš„ç¨³å®šæ€§

## æ–‡ä»¶ä¿®æ”¹æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶
- `lib/entity_storage.rb`: å®ä½“å­˜å‚¨å™¨æ ¸å¿ƒé€»è¾‘
- `lib/wall_builder.rb`: å¢™ä½“ç”Ÿæˆå™¨
- `lib/equipment_builder.rb`: è®¾å¤‡ç”Ÿæˆå™¨
- `lib/zone_builder.rb`: åŒºåŸŸç”Ÿæˆå™¨
- `lib/flow_builder.rb`: æµç”Ÿæˆå™¨
- `lib/structure_builder.rb`: ç»“æ„ç”Ÿæˆå™¨ï¼ˆåŒ…å«ç«‹æŸ±ï¼‰

### æµ‹è¯•æ–‡ä»¶
- `test_entity_storage_fix.rb`: å®ä½“å­˜å‚¨å™¨æµ‹è¯•å·¥å…·

### æ–‡æ¡£æ–‡ä»¶
- `å®ä½“å­˜å‚¨å™¨ä¿®å¤æ–¹æ¡ˆ.md`: æœ¬æ–‡æ¡£

## é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼Œä½¿ç”¨152639.jsonåˆ›å»ºçš„å®ä½“å°†å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š

1. **å”¯ä¸€å‘½å**: æ¯ä¸ªå®ä½“éƒ½æœ‰å”¯ä¸€çš„åç§°ï¼Œå¦‚"å¢™ä½“_wall_1", "å¢™ä½“_wall_2"ç­‰
2. **ç²¾ç¡®é€‰æ‹©**: ç‚¹å‡»ä¸åŒçš„å®ä½“èœå•é¡¹ä¼šé€‰ä¸­å¯¹åº”çš„å®ä½“
3. **æ‰¹é‡æ“ä½œ**: å¯ä»¥ä¸€æ¬¡æ€§é€‰æ‹©æ‰€æœ‰åŒç±»å‹çš„å®ä½“
4. **æ··åˆé€‰æ‹©**: æ”¯æŒè·¨ç±»å‹çš„å®ä½“ç»„åˆé€‰æ‹©
5. **æ™ºèƒ½è¿‡æ»¤**: è‡ªåŠ¨è¿‡æ»¤å†²çªå®ä½“ï¼Œé¿å…è¯¯é€‰
6. **æ¸…æ™°æ ‡è¯†**: å®ä½“åç§°åŒ…å«å”¯ä¸€IDï¼Œä¾¿äºè¯†åˆ«å’Œç®¡ç†
7. **ç¨³å®šå¯é **: é€‰æ‹©åŠŸèƒ½ä¸å†å—åŒåå®ä½“å½±å“
8. **åˆç†èœå•**: ç§»é™¤ä¸éœ€è¦çš„é—¨ç±»å‹ï¼Œèœå•ç»“æ„æ›´åŠ åˆç†

è¿™æ ·å°±å½»åº•è§£å†³äº†å®ä½“å­˜å‚¨å™¨ä¸­åŒåå®ä½“æ— æ³•æ­£ç¡®åŒºåˆ†çš„é—®é¢˜ï¼Œå¹¶å¢åŠ äº†é«˜æ•ˆçš„æ‰¹é‡é€‰æ‹©åŠŸèƒ½å’Œæ™ºèƒ½çš„å†²çªè¿‡æ»¤åŠŸèƒ½ã€‚

## æ€»ç»“

æœ¬ä¿®å¤æ–¹æ¡ˆæˆåŠŸè§£å†³äº†å®ä½“å­˜å‚¨å™¨çš„å¤šä¸ªå…³é”®é—®é¢˜ï¼š

1. **å®ä½“å”¯ä¸€æ€§**ï¼šé€šè¿‡å”¯ä¸€IDå’Œåç§°è§£å†³äº†åŒåå®ä½“çš„é€‰æ‹©é—®é¢˜
2. **æ‰¹é‡é€‰æ‹©**ï¼šæä¾›äº†é€‰æ‹©æ‰€æœ‰åŒç±»å‹å®ä½“å’Œæ·»åŠ åˆ°é€‰æ‹©çš„åŠŸèƒ½
3. **å†²çªè¿‡æ»¤**ï¼šå®ç°äº†æ™ºèƒ½çš„å®ä½“å†²çªè¿‡æ»¤ï¼Œé¿å…é€‰æ‹©å†²çª
4. **æè´¨ä¿æŠ¤**ï¼šè‡ªåŠ¨è¯†åˆ«å’Œä¿æŠ¤çª—æˆ·ï¼Œé˜²æ­¢è¢«å¢™ä½“æè´¨è¦†ç›–
5. **ç”¨æˆ·ä½“éªŒ**ï¼šä¼˜åŒ–äº†èœå•ç»“æ„å’Œæ“ä½œæµç¨‹ï¼Œæé«˜äº†ä½¿ç”¨æ•ˆç‡

### ğŸ¯ **æ ¸å¿ƒæŠ€æœ¯åˆ›æ–°**

- **å¢™ä½“å’Œçª—æˆ·å¯¹åº”å…³ç³»å­˜å‚¨**ï¼šå»ºç«‹ç²¾ç¡®çš„æ˜ å°„å…³ç³»ï¼Œæ”¯æŒæ™ºèƒ½åé€‰
- **æè´¨åº”ç”¨ä¿æŠ¤æœºåˆ¶**ï¼šé€šè¿‡å¤šé‡å±æ€§è¯†åˆ«ï¼Œè‡ªåŠ¨è·³è¿‡çª—æˆ·ç›¸å…³å®ä½“
- **é€’å½’ä¿æŠ¤ç®—æ³•**ï¼šæ·±åº¦åµŒå¥—çš„çª—æˆ·å®ä½“ä¹Ÿèƒ½è¢«æ­£ç¡®è¯†åˆ«å’Œä¿æŠ¤
- **ç«‹æŸ±å­˜å‚¨ç®¡ç†**ï¼šæ–°å¢ç«‹æŸ±ç±»å‹æ”¯æŒï¼Œå®Œæ•´çš„å­˜å‚¨ã€é€‰æ‹©å’Œæ‰¹é‡æ“ä½œåŠŸèƒ½

### âœ… **æœ€ç»ˆæ•ˆæœ**

é€šè¿‡å¢™ä½“å’Œçª—æˆ·å¯¹åº”å…³ç³»å­˜å‚¨ã€æ™ºèƒ½åé€‰è¿‡æ»¤ã€æè´¨åº”ç”¨ä¿æŠ¤ã€ç«‹æŸ±å­˜å‚¨ç®¡ç†ç­‰æŠ€æœ¯çš„ç»¼åˆåº”ç”¨ï¼Œç³»ç»Ÿç°åœ¨èƒ½å¤Ÿï¼š
- ç²¾ç¡®è¯†åˆ«å’Œé€‰æ‹©æ¯ä¸ªå®ä½“
- æ™ºèƒ½å¤„ç†å®ä½“é—´çš„å†²çªå…³ç³»
- **è‡ªåŠ¨ä¿æŠ¤çª—æˆ·ä¸è¢«æè´¨è¦†ç›–**ï¼ˆæ ¸å¿ƒçªç ´ï¼‰
- æä¾›é«˜æ•ˆä¾¿æ·çš„æ‰¹é‡æ“ä½œ
- æ”¯æŒä¸­è‹±æ–‡çª—æˆ·åç§°è¯†åˆ«
- **å®Œæ•´æ”¯æŒç«‹æŸ±ç®¡ç†**ï¼ˆæ–°å¢åŠŸèƒ½ï¼‰

### ğŸš€ **åº”ç”¨ä»·å€¼**

è¿™ä¸ªè§£å†³æ–¹æ¡ˆä¸ä»…ä¿®å¤äº†åŸæœ‰çš„é—®é¢˜ï¼Œè¿˜ä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚ç‰¹åˆ«æ˜¯åœ¨å·¥å‚å¸ƒå±€è®¾è®¡ä¸­ï¼Œèƒ½å¤Ÿï¼š
- ä¿æŒçª—æˆ·çš„é€æ˜ç»ç’ƒæ•ˆæœ
- å…è®¸å¢™ä½“æè´¨çš„è‡ªç”±è°ƒæ•´
- é¿å…æ‰‹åŠ¨æ’é™¤çª—æˆ·çš„ç¹çæ“ä½œ
- æé«˜æ•´ä½“å»ºæ¨¡æ•ˆç‡å’Œè´¨é‡
- **æ”¯æŒç«‹æŸ±çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†**
- **æ‰©å±•å®ä½“ç±»å‹æ”¯æŒï¼Œä¸ºæœªæ¥åŠŸèƒ½å¥ å®šåŸºç¡€**

**æµ‹è¯•éªŒè¯**ï¼šâœ… å®Œå…¨æœ‰æ•ˆï¼Œå¢™ä½“æè´¨æ­£å¸¸åº”ç”¨ï¼Œçª—æˆ·ä¿æŒåŸæœ‰æ•ˆæœ 