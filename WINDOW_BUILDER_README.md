# 窗户生成器重新设计说明

## 概述
窗户生成器已重新设计，现在采用更简洁的方法：直接在墙面上挖洞，在窗洞中心厚度处生成玻璃面，不再生成窗户框和窗台。

## 新的数据格式

### 窗户数据 (window_data)
```json
{
  "id": "window_001",
  "name": "窗户名称",
  "position": [5000, 3000, 1500],  // 窗户中心点坐标（毫米）
  "size": [1200, 1000],            // 窗户面的长度和宽度（毫米）
  "height": 1500                    // 窗户中心点到地面的高度（毫米）
}
```

### 参数说明
- **position**: 窗户中心点坐标 `[x, y, z]`（毫米）
- **size**: 窗户尺寸 `[宽度, 高度]`（毫米）
- **height**: 窗户中心点到地面的高度（毫米）

## 生成流程

### 1. 数据解析
- 解析窗户中心点坐标
- 计算窗户的宽度和高度
- 确定窗户的底部和顶部高度

### 2. 墙体分析
- 获取墙体方向向量
- 计算墙体法线方向
- 基于中心点和宽度计算窗户的起点和终点

### 3. 挖洞操作
- **零厚度墙体**: 使用布尔运算创建开口
- **正常厚度墙体**: 沿法线方向拉伸切割面

### 4. 玻璃面生成
- 在窗洞中心厚度处生成玻璃面
- 设置玻璃材质（半透明浅蓝色）
- 稍微向内偏移避免与墙体重叠

## 技术特点

### 参考门的生成方法
- 墙体方向获取：`wall_vector = wall_end - wall_start`
- 法线计算：`wall_normal = wall_vector.cross(Geom::Vector3d.new(0, 0, 1)).normalize`
- 厚度处理：支持零厚度和正常厚度墙体

### 挖洞方向获取
- 基于墙体起点和终点计算方向向量
- 使用向量叉积计算法线方向
- 沿法线方向进行挖洞操作

### 数据获取方法
- 使用 `Utils.validate_and_create_point()` 验证坐标
- 使用 `Utils.parse_number()` 解析数值
- 自动单位转换（毫米转米）

## 使用示例

```ruby
# 创建窗户数据
window_data = {
  "id" => "window_001",
  "name" => "主窗户",
  "position" => [5000, 3000, 1500],
  "size" => [1200, 1000],
  "height" => 1500
}

# 墙体数据
wall_data = {
  "id" => "wall_001",
  "start" => [0, 0, 0],
  "end" => [10000, 0, 3000],
  "thickness" => 200
}

# 生成窗户
window_item = {
  window_data: window_data,
  wall_data: wall_data,
  parent_group: parent_group
}

WindowBuilder.create_all_windows([window_item], parent_group)
```

## 优势

1. **简化设计**: 不再生成复杂的窗户框架，只保留必要的玻璃面
2. **性能提升**: 减少几何体数量，提高渲染性能
3. **维护性**: 代码结构更清晰，易于维护和扩展
4. **一致性**: 与门的生成方法保持一致，便于理解和维护

## 注意事项

1. 确保墙体数据完整（起点、终点、厚度）
2. 窗户尺寸应为正值
3. 窗户高度应合理（建议在0.5-3.0米之间）
4. 玻璃面会自动向内偏移1毫米，避免与墙体重叠 