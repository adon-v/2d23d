# 实体存储器使用说明

功能尚不完善，需进一步开发

## 概述

实体存储器是一个强大的工具，用于自动存储和分类所有在工厂布局导入过程中生成的实体。它提供了完整的实体管理功能，包括分类存储、查询、统计和导出。

## 功能特点

### 📊 **自动分类存储**
- **工厂大地面** - 存储所有工厂大地面的实体
- **内部区域** - 存储所有内部功能区域的实体
- **外部区域** - 存储所有外部区域的实体
- **窗户** - 存储所有窗户相关的实体
- **墙体** - 存储所有墙体实体
- **设备** - 存储所有设备实体
- **胶带** - 存储所有胶带标识实体
- **流通道** - 存储所有流通道实体
- **其他结构** - 存储其他类型的结构实体

### 🔍 **智能查询功能**
- 按类型查询实体
- 按ID查找实体
- 按GUID查找实体
- 按名称模式查找实体
- 获取实体统计信息

### 📈 **统计和分析**
- 实时统计各类型实体数量
- 显示实体创建时间
- 导出实体信息到JSON文件
- 查看详细的实体列表

### 🎛️ **管理功能**
- 清空指定类型的实体
- 清空所有实体
- 删除单个实体
- 实体状态监控

## 使用方法

### 1. 菜单访问
在SketchUp中，您可以通过以下路径访问实体存储器：
```
Extensions → 实体存储器
```

### 2. 主要功能

#### 显示统计信息
- 点击：`Extensions → 实体存储器 → 显示统计信息`
- 显示所有实体的统计信息，包括：
  - 总实体数量
  - 各类型实体的数量
  - 实体分类详情

#### 导出实体信息
- 点击：`Extensions → 实体存储器 → 导出实体信息`
- 将实体信息导出为JSON文件，包含：
  - 实体ID和GUID
  - 实体名称和类型
  - 创建时间
  - 元数据信息

#### 清空所有实体
- 点击：`Extensions → 实体存储器 → 清空所有实体`
- 带确认对话框，防止误操作

#### 动态实体类型菜单
每种实体类型都有独立的子菜单，包含以下功能：

**🏭 工厂大地面**
- 显示所有工厂大地面
- 选中所有工厂大地面
- 具体工厂地面列表（导入后显示）

**🏢 内部区域**
- 显示所有内部区域
- 选中所有内部区域
- 具体内部区域列表（导入后显示）

**🌳 外部区域**
- 显示所有外部区域
- 选中所有外部区域
- 具体外部区域列表（导入后显示）

**🧱 墙体**
- 显示所有墙体
- 选中所有墙体
- 具体墙体列表（导入后显示）

**🪟 窗户**
- 显示所有窗户
- 选中所有窗户
- 具体窗户列表（导入后显示）



**⚙️ 设备**
- 显示所有设备
- 选中所有设备
- 具体设备列表（导入后显示）

**🎯 胶带**
- 显示所有胶带
- 选中所有胶带
- 具体胶带列表（导入后显示）

**🌊 流通道**
- 显示所有流通道
- 选中所有流通道
- 具体流通道列表（导入后显示）

**🏗️ 其他结构**
- 显示所有其他结构
- 选中所有其他结构
- 具体结构列表（导入后显示）

### 🎯 **具体实体菜单项**
导入模型后，每个分类下会显示具体的实体名称，例如：

**墙体分类下可能显示：**
- 墙体_主墙体_wall_001
- 墙体_分隔墙_wall_002
- 墙体_外墙_wall_003

**内部区域分类下可能显示：**
- 内部区域_生产区域_生产
- 内部区域_办公区域_办公
- 内部区域_仓储区域_仓储

**点击任意实体名称可直接选中对应的实体！**

## 自动存储机制

### 🔄 **自动存储过程**
当您导入工厂布局时，实体存储器会自动：

1. **独立初始化** - 在导入开始时独立初始化，不影响主流程
2. **自动分类存储** - 根据实体类型自动分类
3. **记录元数据** - 存储实体的详细信息
4. **实时更新** - 随着实体创建实时更新存储
5. **错误隔离** - 存储失败不会影响模型生成

### 🎯 **菜单同步更新**
导入完成后，实体存储器会自动：

1. **更新菜单内容** - 将存储的实体信息同步到菜单
2. **显示实体列表** - 每种类型下显示具体的实体名称
3. **支持直接选中** - 点击实体名称可直接选中对应实体
4. **实时同步** - 每次导入后菜单内容自动更新

### 📋 **存储的实体信息**
每个实体记录包含：
- **实体对象** - SketchUp实体引用
- **实体ID** - 唯一标识符
- **GUID** - 全局唯一标识符
- **名称** - 实体名称
- **类型** - 实体类型
- **元数据** - 额外的属性信息
- **创建时间** - 实体创建时间戳

## 实体类型详解

### 🏭 **工厂大地面 (factory_ground)**
- 存储工厂的大地面实体
- 包含生成方法和相关参数
- 元数据：生成方法、工厂数量、边界点数量

### 🏢 **内部区域 (indoor_zone)**
- 存储内部功能区域
- 包含区域ID、名称、类型等信息
- 元数据：区域ID、区域名称、区域类型、形状类型、点数

### 🌳 **外部区域 (outdoor_zone)**
- 存储外部区域
- 包含区域的基本信息
- 元数据：区域ID、区域名称、形状类型、点数

### 🧱 **墙体 (wall)**
- 存储所有墙体实体
- 包含墙体的几何和属性信息
- 元数据：墙体ID、墙体名称、起点、终点、厚度、高度

### 🪟 **窗户 (window)**
- 存储窗户相关实体
- 包含窗户的属性和位置信息
- 元数据：窗户ID、窗户名称、位置、尺寸



### ⚙️ **设备 (equipment)**
- 存储设备实体
- 包含设备的属性和位置信息
- 元数据：设备ID、设备名称、位置、尺寸

### 🎯 **胶带 (tape)**
- 存储胶带标识实体
- 包含胶带的属性和位置信息
- 元数据：胶带类型、位置、尺寸

### 🌊 **流通道 (flow)**
- 存储流通道实体
- 包含流通道的路径和属性信息
- 元数据：流通道ID、路径点、宽度

### 🏗️ **其他结构 (structure)**
- 存储其他类型的结构实体
- 包含结构的基本信息
- 元数据：结构类型、属性信息

## 编程接口

### 基本操作
```ruby
# 初始化存储器
EntityStorage.init

# 添加实体
EntityStorage.add_entity("wall", wall_group, {wall_id: "wall_001"})

# 批量添加实体
EntityStorage.add_entities("window", window_groups, {factory_id: "factory_001"})

# 获取指定类型的实体
walls = EntityStorage.get_entities_by_type("wall")

# 获取所有实体
all_entities = EntityStorage.get_all_entities()

# 查找实体
entity = EntityStorage.find_entity_by_id(entity_id)
entity = EntityStorage.find_entity_by_guid(guid)
entities = EntityStorage.find_entities_by_name("wall")
```

### 统计和导出
```ruby
# 获取统计信息
stats = EntityStorage.get_statistics()

# 导出到JSON
export_data = EntityStorage.export_to_json()

# 保存到文件
EntityStorage.save_to_file("entities.json")

# 从文件加载
data = EntityStorage.load_from_file("entities.json")
```

### 管理操作
```ruby
# 删除实体
EntityStorage.remove_entity(entity_id)

# 清空指定类型
EntityStorage.clear_entities_by_type("wall")

# 清空所有实体
EntityStorage.clear_all_entities()

# 获取状态
status = EntityStorage.get_status()
```

## 注意事项

### ⚠️ **重要提醒**
1. **独立功能** - 实体存储器是完全独立的功能，不影响正常的工厂布局导入流程
2. **错误隔离** - 即使实体存储器出现错误，也不会影响模型生成和导入
3. **可选功能** - 实体存储器是可选的增强功能，可以随时禁用
4. **内存管理** - 大量实体可能占用较多内存
5. **实体有效性** - 只存储有效的实体对象
6. **类型验证** - 自动验证实体类型的有效性
7. **数据持久性** - 实体信息仅在当前会话中有效

### 🔧 **故障排除**
1. **实体存储器未加载** - 检查 `lib/entity_storage.rb` 文件是否存在
2. **实体不显示** - 检查实体是否有效
3. **类型错误** - 确保使用正确的实体类型常量
4. **内存不足** - 考虑清空不需要的实体
5. **导出失败** - 检查文件路径和权限
6. **主流程受影响** - 实体存储器错误不会影响主流程，可以安全忽略

## 高级功能

### 🔍 **智能查询**
- 支持模糊名称匹配
- 支持元数据过滤
- 支持时间范围查询

### 📊 **数据分析**
- 实体创建时间分析
- 类型分布统计
- 空间分布分析

### 🔄 **批量操作**
- 批量删除指定类型的实体
- 批量导出指定类型的实体
- 批量修改实体属性

## 更新日志

### v1.0.0
- ✅ 基础实体存储功能
- ✅ 自动分类存储
- ✅ 实体查询功能
- ✅ 统计信息显示
- ✅ 导出功能
- ✅ 管理功能
- ✅ 编程接口

---

**享受使用实体存储器管理您的工厂布局实体！** 📊✨ 